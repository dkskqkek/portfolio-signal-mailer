name: Antigravity V4 Stratgey Signal

on:
  schedule:
    # UTC 22:30 = KST 07:30 (Next Day)
    - cron: "30 22 * * *"
  workflow_dispatch: # Manual Trigger

jobs:
  daily-signal:
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.9"

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas numpy yfinance pyyaml requests

      - name: Run V4 Daily Signal (Every Day)
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: python scripts/daily_signal_discord.py

      - name: Run Weekly Report (Mondays Only)
        if: github.event.schedule == '30 22 * * 1' || github.event_name == 'workflow_dispatch'
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          # Determine if KIS sync is needed. Without KIS keys, it might fail or skip sync.
          # For now, we assume user might handle KIS keys later or just wants list output.
        run: |
          # Check if script supports env var, if not this might require update.
          # We run it and let it fail gracefully if config missing, or success if fixed.
          python weekly_performance_report.py || echo "Weekly report failed or skipped."
